---
title: ""
author: "Glushkov Egor"
date: "29 03 2022"
output: html_document
---

### Data Science: предварительный анализ данных в R

> Data Science: инструментарий и жизненный цикл проекта    
> Глушков Егор Александрович, гр. 20.М04-мм  


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#### Загрузка и описание данных

```{r}
data(mtcars)
```

```{r echo=F, results='show'}
t_var <- c("mpg", "cyl", "disp", "hp", "drat", "wt", 
           "qsec", "vs", "am", "gear", "carb")
t_descr <- c("Миль/Галлон", "Число цилиндров", "Рабочий объем (куб. дюймов)",
             "Полная мощность (лошадиных сил)", "Передаточное отношение задней оси", 
             "Вес (1000 фунтов)", "Время 1/4 мили", 
             "Двигатель (0=V-образный, 1=прямой)", 
             "Трансмиссия (0=автоматическая, 1=ручная)", 
             "Количество передач переднего хода", "Количество карбюраторов")
t_scale <- c("Отношений", "Интервальная", "Отношений", "Отношений", "Отношений", "Отношений", "Отношений", "Номинальная (бинарная)", "Номинальная (бинарная)", "Интервальная", "Интервальная")
t_title <- c("Переменная", "Описание", "Шкала")

df <- data.frame(t_var, t_descr, t_scale)
names(df) <- t_title
print(df)
```

```{r types}
mtcars2 <- within(mtcars, {
   vs <- factor(vs, labels = c("V", "S"))
   am <- factor(am, labels = c("automatic", "manual"))
   cyl  <- ordered(cyl)
   gear <- ordered(gear)
   carb <- ordered(carb)
})
```

```{r}
summary(mtcars2)
```

```{r}
head(mtcars2)
```
Встроенный набор данных *mtcars* содержит $32$ наблюдения по $11$ признакам. Некоторые признаки перекодируем в соответствующие шкалы (интервальные, бинарные).

#### Проверка гипотез однородности

Проверим однородность подвыборок (признак Миль/Галлон *mt*) по фактору Тип двигателя (*vs*). Построим гистограмму частот с разбиением по указанному фактору.

```{r warning=FALSE}
library(ggplot2)

ggplot(data=mtcars2, aes(x=mpg, fill=vs)) +
  geom_histogram(binwidth = 1.25) +
  labs(title="Разбиение данных", 
       x="Миль/Галлон (mpg)", y="Количество") +
  scale_fill_discrete(name = "Двигатель (vs)", labels = c("V-образный", "Прямой (S)"))
```

Проиллюстрируем распределения в подвыборках с помощью "ящика с усами" (*boxplot*):
```{r}
mtc <- data.frame(group=mtcars2$vs, X=mtcars2$mpg)
boxplot(X ~ group, mtc, xlab = "Тип двигателя", ylab = "Миль/Галлон")
```

Проверим нормальность данных в подвыборках:
```{r}
p.Sh <- with(mtc, tapply(X, group, function(x)shapiro.test(x)$p.value)); p.Sh
```
Согласие с нормальным распределением для обеих групп не отвергается в соответствии с критерием Шапиро-Уилка с $p.value = 0.449$ и $0.167$ при уровне значимости $\alpha = 0.05$.


```{r}
p.F <- var.test(X~group, mtc)$p.value; p.F
```
В соответствии с критерием Фишера гипотеза о равенстве дисперсий двух групп не отвергается ($p.value=0.1997$), значит, можно использовать критерий Стьюдента (с параметром о равенстве дисперсий).

```{r}
p.T <- t.test(X~group, mtc, var.equal=TRUE); p.T
```
По критерию Стьюдента гипотеза о равенстве средних не принимается ($p.value=3.415937 \times 10^{-5}$) на уровне значимости $\alpha = 0.05$, то есть различие средних в двух группах (различающихся по типу двигателя) значимо: автомобили с V-образным двигателем ($16.62$ миль/галлон) действительно проезжают в среднем меньше, чем автомобили с прямым двигателем ($24.56$).

#### Множественная линейная регрессия 

Построим модель множественной линейной регресии, зависящей от всех имеющихся переменных:
```{r}
init.model <- lm(mpg~., data=mtcars)
summary(init.model)
```

Согласно $p.value=3.793 \times 10^{-7}$ с уровнем значимости $\alpha = 0.001$ не принимается гипотеза о том, что данная модель не зависит от переменных (предикторов). При этом лишь переменная *wt* отлична от нуля с уровнем значимости $0.1$. Коэффициент детерминации равен $0.869$, скорректированный -- $0.8066$.    

Произведем пошаговую подгонку регрессии, когда на каждом шаге добавляется наиболее значимая переменная (в соответствии с информационным критерием Акаике *AIC*). 
```{r warning=FALSE}
library(MASS)

empty_m <- lm(mpg ~ 1, mtcars)
SA.f <- stepAIC(empty_m, direction = 'forward', scope=list(lower=empty_m, upper=~cyl + disp + hp + drat + wt + qsec + vs + am + gear + carb))
summary(SA.f)

```
Итоговая модель построена на трёх переменных: *wt*, *cyl*, *hp*, первые две из которых значимо отличны от нуля (с уровнями значимости $0.001$, $0.1$ соответственно). Сама модель также значимо зависит от переменных с $p.value=2.18 \times 10^{-11}$.

Коэффициент детерминации равен $0.8431$, скорректированный -- $0.8263$.

Модель с "обратным ходом", исключающая переменные:

```{r}
SA.b <- stepAIC(init.model, direction = 'backward')
summary(SA.b)

```
Модель с "обратным ходом" значимо ($p.value=1.21 \times 10^{-11}$) зависит от трех переменных (*wt*, *qsec*, *am*), каждая из которых является ненулевой при уровне значимости $\alpha = 0.05$. Коэффициент детерминации равен $0.8497$, скорректированный -- $0.8336$.

Таким образом, последняя модель множественной линейной регрессии, исключающая переменные, показывает наилучший результат (в соответствии со скорректированным коэффициентом детерминации).
